title: NPFL114, Lecture 1
class: title, langtech, cc-by-nc-sa
# Introduction to Deep Learning

## Milan Straka

### March 01, 2021

---
# What is Deep Learning

![w=38%,h=center](deep_learning.jpg)

---
# Deep Learning Highlights
- Image recognition

~~~ ~
# Deep Learning Highlights
![w=60%,h=center](imagenet_recognition.jpg)

~~~ ~~
- Object detection
~~~ ~
# Deep Learning Highlights
![w=100%,v=middle](object_detection.svgz)

~~~ ~~
- Image segmentation,
~~~ ~
# Deep Learning Highlights
![w=100%,v=middle](image_segmentation.svgz)

~~~ ~~
- Human pose estimation
~~~ ~
# Deep Learning Highlights
![w=100%,v=middle](human_pose_estimation.jpg)

~~~ ~~
- Image labeling
~~~ ~
# Deep Learning Highlights
![w=75%,h=center](image_labeling.svgz)

~~~ ~~
- Visual question answering
~~~ ~
# Deep Learning Highlights
![w=70%,h=center](vqa.svgz)

~~~ ~~
- Speech recognition and generation
~~~ ~
# Deep Learning Highlights
![w=100%](tacotron_comparison.svgz)

<audio controls="" style="width: 49%"><source src="https://google.github.io/tacotron/publications/tacotron2/demos/gan_or_vae.wav"></audio>
<audio controls="" style="width: 49%"><source src="https://google.github.io/tacotron/publications/tacotron2/demos/fox_question.wav"></audio>

~~~ ~~
- Lip reading
~~~ ~
# Deep Learning Highlights
![w=70%,h=center](lrw_showcase.svgz)
![w=70%,h=center](lipnet_saliency.svgz)

~~~ ~~
- Machine translation
~~~ ~
# Deep Learning Highlights
![w=44%,h=center](attention_visualization.svgz)

~~~ ~~
- Machine translation without parallel data
~~~ ~
# Deep Learning Highlights
![w=70%,h=center](umt_ideas.svgz)
![w=30%,h=center](umt_comparison.svgz)

~~~ ~~
- Chess, Go and Shogi
~~~ ~
# Deep Learning Highlights
![w=95%,h=center](a0_results.svgz)

~~~ ~~
- Multiplayer Capture the flag
~~~ ~
# Deep Learning Highlights
![w=100%,v=middle](ctf_overview.svgz)

~~~ ~~

---
section: Organization

# Organization

**Course Website** https://ufal.mff.cuni.cz/courses/npfl114
- Recordings of lectures and practicals, slides, assignments, exam questions.

~~~
**Course Repository** https://github.com/ufal/npfl114
- Templates for the assignments, slide sources.

~~~
## Piazza

- Piazza will be used as a communication platform.

  You can post questions or notes,
  - privately to the instructors, or
~~~
  - to everyone (signed or anonymously).
~~~

  Students can answer other student's questions too, which allows you to get
  faster response. Please do not send complete solutions to other students,
  only excerpts of the source files.

~~~
- Please use Piazza for **all communication** with the instructors.
~~~
- You will get the invite link after the first lecture.

---
# ReCodEx

https://recodex.mff.cuni.cz

- The assignments will be evaluated automatically in ReCodEx.
~~~
- If you have a MFF SIS account, you will be able to create an account
  using your CAS credentials and will be automatically assigned
  to the right group.
~~~
- Otherwise follow the instructions on Piazza; generally you will need to send
  me a message with several pieces of information and I will send it to ReCodEx
  administrators in batches.

---
# Course Requirements

## Practicals
~~~

- There will be 2-3 assignments a week, each with 2-week deadline.
~~~
  - Deadlines can be extended, but you need to write **before** the deadline.
~~~
- After solving the assignment, you get non-bonus points, and sometimes also
  bonus points.
~~~
- To pass the practicals, you need to get 80 non-bonus points. There will be
  assignments for at least 120 non-bonus points.
~~~
- If you get more than 80 points (be it bonus or non-bonus), they will be
  all transferred to the exam. Additionally, if you solve all the assignments,
  you obtain 50 bonus points.

~~~
## Lecture

You need to pass a written exam (or solve all the assignments).
~~~
- All questions are publicly listed on the course website.
~~~
- There are questions for 100 points in every exam, plus the surplus
  points from the practicals and plus at most 10 surplus points for **community
  work** (improving slides, ‚Ä¶).
~~~
- You need 60/75/90 points to pass with grade 3/2/1; 75 points for PhD students.

---
section: Notation
# Notation

- $a$, $‚Üía$, $‚áâA$, $‚á∂A$: scalar (integer or real), vector, matrix, tensor

- $‚Åáa$, $‚Åá‚Üía$, $‚Åá‚áâA$: scalar, vector, matrix random variable

~~~
- $\frac{df}{dx}$: derivative of $f$ with respect to $x$

- $\frac{‚àÇf}{‚àÇx}$: partial derivative of $f$ with respect to $x$

~~~
- $‚àá_‚Üíx f$: gradient of $f$ with respect to $‚Üíx$, i.e.,
  $\left(\frac{‚àÇf(‚Üíx)}{‚àÇx_1}, \frac{‚àÇf(‚Üíx)}{‚àÇx_2}, \ldots, \frac{‚àÇf(‚Üíx)}{‚àÇx_n}\right)$

---
section: Random Variables
# Random Variables
A random variable $‚Åáx$ is a result of a random process. It can be discrete or
continuous.

~~~
## Probability Distribution
A probability distribution describes how likely are individual values a random
variable can take.

The notation $‚Åáx ‚àº P$ stands for a random variable $‚Åáx$ having a distribution $P$.

~~~
For discrete variables, the probability that $‚Åáx$ takes a value $x$ is denoted as
$P(x)$ or explicitly as $P(‚Åáx = x)$. All probabilities are non-negative and sum
of probabilities of all possible values of $‚Åáx$ is $‚àë_x P(‚Åáx=x) = 1$.

~~~
For continuous variables, the probability that the value of $‚Åáx$ lies in the interval
$[a, b]$ is given by $‚à´_a^b p(x)\d x$.

---
# Random Variables

## Expectation
The expectation of a function $f(x)$ with respect to discrete probability
distribution $P(x)$ is defined as:
$$ùîº_{‚Åáx ‚àº P}[f(x)] ‚âù ‚àë_x P(x)f(x)$$

For continuous variables it is computed as:
$$ùîº_{‚Åáx ‚àº p}[f(x)] ‚âù ‚à´_x p(x)f(x)\d x$$

~~~
If the random variable is obvious from context, we can write only $ùîº_P[x]$
or even $ùîº[x]$.

~~~
Expectation is linear, i.e.,
$$ùîº_‚Åáx [Œ±f(x) + Œ≤g(x)] = Œ±ùîº_‚Åáx [f(x)] + Œ≤ùîº_‚Åáx [g(x)]$$

---
# Random Variables

## Variance
Variance measures how much the values of a random variable differ from its
mean $Œº = ùîº[x]$.

$$\begin{aligned}
  \Var(x) &‚âù ùîº\left[\big(x - ùîº[x]\big)^2\right]\textrm{, or more generally} \\
  \Var(f(x)) &‚âù ùîº\left[\big(f(x) - ùîº[f(x)]\big)^2\right]
\end{aligned}$$

~~~
It is easy to see that
$$\Var(x) = ùîº\left[x^2 - 2xùîº[x] + \big(ùîº[x]\big)^2\right] = ùîº\left[x^2\right] - \big(ùîº[x]\big)^2.$$

~~~
Variance is connected to $E[x^2]$, a _second moment_ of a random
variable ‚Äì it is in fact a _centered_ second moment.

---
# Common Probability Distributions
## Bernoulli Distribution
The Bernoulli distribution is a distribution over a binary random variable.
It has a single parameter $œÜ ‚àà [0, 1]$, which specifies the probability of the random
variable being equal to 1.

~~~
![w=50%,f=right](bernoulli_variance.svgz)

$$\begin{aligned}
  P(x) &= œÜ^x (1-œÜ)^{1-x} \\
  ùîº[x] &= œÜ \\
  \Var(x) &= œÜ(1-œÜ)
\end{aligned}$$

~~~
## Categorical Distribution
Extension of the Bernoulli distribution to random variables taking one of $k$ different
discrete outcomes. It is parametrized by $‚Üíp ‚àà [0, 1]^k$ such that $‚àë_{i=1}^{k} ‚Üíp_{i} = 1$.
$$\begin{aligned}
  P(‚Üíx) &= ‚àè\nolimits_i^k ‚Üíp_i^{‚Üíx_i} \\
  ùîº[‚Üíx_i] &= ‚Üíp_i, \Var(‚Üíx_i) = ‚Üíp_i(1-‚Üíp_i) \\
\end{aligned}$$

---
section: Information Theory
# Information Theory

## Self Information

Amount of **surprise** when a random variable is sampled.
~~~
- Should be zero for events with probability 1.
~~~
- Less likely events are more surprising.
~~~
- Independent events should have **additive** information.

~~~
$$I(x) ‚âù -\log P(x) = \log \frac{1}{P(x)}$$

---
# Information Theory

## Entropy

Amount of **surprise** in the whole distribution.
$$H(P) ‚âù ùîº_{‚Åáx‚àºP}[I(x)] = -ùîº_{‚Åáx‚àºP}[\log P(x)]$$

~~~
- for discrete $P$: $H(P) = -‚àë_x P(x) \log P(x)$
- for continuous $P$: $H(P) = -‚à´ P(x) \log P(x)\,\mathrm dx$

~~~ ~~
![w=40%,f=right](entropy_example.svgz)

- for discrete $P$: $H(P) = -‚àë_x P(x) \log P(x)$
- for continuous $P$: $H(P) = -‚à´ P(x) \log P(x)\,\mathrm dx$

~~~
Note that in the continuous case, the continuous entropy (also called
_differential entropy_) has slightly different semantics, for example, it can be
negative.

~~~
From now on, all logarithms are _natural logarithms_ with base $e$.

---
# Information Theory

## Cross-Entropy

$$H(P, Q) ‚âù -ùîº_{‚Åáx‚àºP}[\log Q(x)]$$

~~~
- Gibbs inequality
    - $H(P, Q) ‚â• H(P)$
    - $H(P) = H(P, Q) ‚áî P = Q$
~~~
    - Proof: Using Jensen's inequality, we get
      $$‚àë_x P(x) \log \frac{Q(x)}{P(x)} ‚â§ \log ‚àë_x P(x) \frac{Q(x)}{P(x)} = \log ‚àë_x Q(x) = 0.$$
~~~
    - Corollary: For a categorical distribution with $n$ outcomes, $H(P) ‚â§ \log n$,
    because for $Q(x) = 1/n$ we get $H(P) ‚â§ H(P, Q) = -‚àë_x P(x) \log Q(x) = \log n.$
~~~
- generally $H(P, Q) ‚â† H(Q, P)$

---
# Information Theory

## Kullback-Leibler Divergence (KL Divergence)

Sometimes also called **relative entropy**.

$$D_\textrm{KL}(P \| Q) ‚âù H(P, Q) - H(P) = ùîº_{‚Åáx‚àºP}[\log P(x) - \log Q(x)]$$

~~~
- consequence of Gibbs inequality: $D_\textrm{KL}(P \| Q) ‚â• 0$, $D_\textrm{KL}(P \| Q) = 0$ iff $P = Q$
~~~
- generally $D_\textrm{KL}(P \| Q) ‚â† D_\textrm{KL}(Q \| P)$

---
# Nonsymmetry of KL Divergence

![w=100%,v=middle](kl_nonsymmetry.svgz)

---
# Common Probability Distributions
## Normal (or Gaussian) Distribution
Distribution over real numbers, parametrized by a mean $Œº$ and variance $œÉ^2$:
$$ùìù(x; Œº, œÉ^2) = \sqrt{\frac{1}{2œÄœÉ^2}} \exp \left(-\frac{(x - Œº)^2}{2œÉ^2}\right)$$

For standard values $Œº=0$ and $œÉ^2=1$ we get $ùìù(x; 0, 1) = \sqrt{\frac{1}{2œÄ}} e^{-\frac{x^2}{2}}$.

![w=45%,h=center](normal_distribution.svgz)

---
# Why Normal Distribution

## Central Limit Theorem
The sum of independent identically distributed random variables
with finite variance converges to normal distribution.

~~~
## Principle of Maximum Entropy
Given a set of constraints, a distribution with maximal entropy fulfilling the
constraints can be considered the most general one, containing as little
additional assumptions as possible.

~~~
Considering distributions on all real numbers with a given mean and variance, it
can be proven (using variational inference) that such a distribution with
**maximum entropy** is exactly the normal distribution.

---
section: Machine Learning
# Machine Learning

A possible definition of learning from Mitchell (1997):
>  A computer program is said to learn from experience E with respect to some
>  class of tasks T and performance measure P, if its performance at tasks in
>  T, as measured by P, improves with experience E.

~~~
- Task T
    - _classification_: assigning one of $k$ categories to a given input
    - _regression_: producing a number $x‚àà‚Ñù$ for a given input
    - _structured prediction_, _denoising_, _density estimation_, ‚Ä¶
~~~
- Measure P
    - _accuracy_, _error rate_, _F-score_, ‚Ä¶
~~~
- Experience E
    - _supervised_: usually a dataset with desired outcomes (_labels_ or
      _targets_)
    - _unsupervised_: usually data without any annotation (raw text, raw images, ‚Ä¶)
    - _reinforcement learning_, _semi-supervised learning_, ‚Ä¶

---
# Well-known Datasets

| Name | Description | Instances |
| ------ | ------------- | ----------- |
| [MNIST](http://yann.lecun.com/exdb/mnist/) | Images (28x28, grayscale) of handwritten digits. | 60k |
| [CIFAR-10](https://www.cs.toronto.edu/~kriz/cifar.html) | Images (32x32, color) of 10 classes of objects. | 50k |
| [CIFAR-100](https://www.cs.toronto.edu/~kriz/cifar.html) | Images (32x32, color) of 100 classes of objects (with 20 defined superclasses). | 50k |
| [ImageNet](http://image-net.org/) | Labeled object image database (labeled objects, some with bounding boxes). | 14.2M |
| [ImageNet-ILSVRC](http://image-net.org/challenges/LSVRC/) | Subset of ImageNet for Large Scale Visual Recognition Challenge, annotated with 1000 object classes and their bounding boxes. | 1.2M |
| [COCO](http://cocodataset.org/) | _Common Objects in Context_: Complex everyday scenes with descriptions (5) and highlighting of objects (91 types). | 2.5M |

---
class: middle
# Well-known Datasets
## ImageNet-ILSVRC
![w=70%,mw=50%,h=center](imagenet_recognition.jpg)![w=50%](imagenet_object_detection.jpg)

---
class: middle
# Well-known Datasets
## COCO
![w=100%,h=center](coco_segmentation.jpg)

---
# Well-known Datasets

| Name | Description | Instances |
| ------ | ------------- | ----------- |
| [IAM-OnDB](http://www.fki.inf.unibe.ch/databases/iam-on-line-handwriting-database) | Pen tip movements of handwritten English from 221 writers. | 86k words |
| [TIMIT](https://catalog.ldc.upenn.edu/LDC93S1) | Recordings of 630 speakers of 8 dialects of American English. | 6.3k sents |
| [CommonVoice](https://voice.mozilla.org/data) | 400k recordings from 20k people, around 500 hours of speech. | 400k
| [PTB](https://catalog.ldc.upenn.edu/LDC99T42) | _Penn Treebank_: 2500 stories from Wall Street Journal, with POS tags and parsed into trees. | 1M words |
| [PDT](https://ufal.mff.cuni.cz/prague-dependency-treebank) | _Prague Dependency Treebank_: Czech sentences annotated on 4 layers (word, morphological, analytical, tectogrammatical). | 1.9M words |
| [UD](http://universaldependencies.org/) | _Universal Dependencies_: Treebanks of 104 languages with consistent annotation of lemmas, POS tags, morphology, syntax. | 183 treebanks |
| [WMT](http://statmt.org/) | Aligned parallel sentences for machine translation. | gigawords |

---
# ILSVRC Image Recognition Error Rates

![w=80%,h=center](ilsvrc.svg)

~~~ ~
# ILSVRC Image Recognition Error Rates

![w=80%,h=center](ilsvrc-complete.svg)

---
# ILSVRC Image Recognition Error Rates

In summer 2017, a paper came out describing automatic generation of
neural architectures using reinforcement learning.

![w=100%](nas_net.svgz)

---
# ILSVRC Image Recognition Error Rates

Currently, one of the best architectures is EfficientNet, which combines
automatic architecture discovery, multidimensional scaling and elaborate dataset
augmentation methods.

![w=50%](efficientnet_flops.svgz)![w=50%](efficientnet_size.svgz)

---
class: wide
# Introduction to Deep Learning History

![w=99%,h=center](figure1_ANN_history.jpg)

---
# How Good is Current Deep Learning

- DL has seen amazing progress in the last ten years.

~~~
- Is it enough to get a bigger brain (datasets, models, computer power)?

~~~
![w=50%,f=right](talosian.jpg)

~~~
- Problems compared to Human learning:
  - Sample efficiency
~~~
  - Human-provided labels
~~~
  - Robustness of data distribution
~~~
  - Stupid errors

---
# How Good is Current Deep Learning

![w=32%,f=right](thinking_fast_and_slow.jpg)

- Thinking fast and slow

~~~
  - System 1

    - intuitive
    - fast
    - automatic
    - frequent
    - unconscious
~~~

    Current DL
~~~
  - System 2

    - logical
    - slow
    - effortful
    - infrequent
    - conscious
~~~

    Future DL

---
# Curse of Dimensionality

![w=100%,v=middle](curse_of_dimensionality.png)

---
# Machine and Representation Learning

![w=35%,h=center](machine_learning.svgz)

---
section: NNs '80s
# Neural Network Architecture √† la '80s

![w=45%,h=center](neural_network.svg)

---
# Neural Network Architecture

There is a weight on each edge, and an activation function $f$ is performed on the
hidden layers, and optionally also on the output layer.
$$h_i = f\left(‚àë_j w_{i,j} x_j + b_i\right)$$

If the network is composed of layers, we can use matrix notation and write:
$$‚Üíh = f\left(‚áâW ‚Üíx + ‚Üíb\right)$$

---
# Neural Network Activation Functions
## Output Layers
- none (linear regression if there are no hidden layers)

~~~
- $œÉ$ (sigmoid; logistic regression if there are no hidden layers)
  $$œÉ(x) ‚âù \frac{1}{1 + e^{-x}}$$
  is used to model a probability $p$ of a binary event; its input is called
  a **logit**, $\log \frac{p}{1-p}$

~~~
- $\softmax$ (maximum entropy model if there are no hidden layers)
  $$\begin{gathered}
    \softmax(‚Üíx) ‚àù e^‚Üíx \\
    \softmax(‚Üíx)_i ‚âù \frac{e^{x_i}}{‚àë_j e^{x_j}}
  \end{gathered}$$
  is used to model probability distribution $‚Üíp$; its input is called
  a **logit**, $\log(‚Üíp) + c$

---
# Neural Network Activation Functions
## Hidden Layers
- none (does not help, composition of linear mapping is a linear mapping)

~~~
- $œÉ$ (but works badly ‚Äì nonsymmetrical, repeated application converges to 1,
  $\frac{dœÉ}{dx}(0) = 1/4$)

~~~
- $\tanh$
    - result of making $œÉ$ symmetrical and making the derivative in zero 1
    - $\tanh(x) = 2œÉ(2x) - 1$
  ![w=45%,h=center](sigmoid_tanh.png)

~~~
- ReLU
    - $\max(0, x)$


---
# Universal Approximation Theorem '89


Let $œÜ(x)$ be a nonconstant, bounded and nondecreasing continuous function.
<br>(Later a proof was given also for $œÜ = \ReLU$ and even for any nonpolynomial
function.)

For any $Œµ > 0$ and any continuous function $f$ on $[0, 1]^D$ there exists
an $N ‚àà ‚Ñï$, $‚Üív ‚àà ‚Ñù^N$, $b ‚àà ‚Ñù^N$ and $‚áâW ‚àà ‚Ñù^{N√óD}$, such that if we denote
$$F(‚Üíx) = ‚Üív^T œÜ(‚áâW‚Üíx + ‚Üíb),$$
then for all $x ‚àà [0, 1]^D$
$$|F(‚Üíx) - f(‚Üíx)| < Œµ.$$

---
# Universal Approximation Theorem for ReLUs

Sketch of the proof:

~~~
- If a function is continuous on a closed interval, it can be approximated by
  a sequence of lines to arbitrary precision.

![w=35%,h=center](relu_approx.svg)

~~~
- However, we can create a sequence of $k$ linear segments as a sum of $k$ ReLU
  units ‚Äì on every endpoint a new ReLU starts (i.e., the input ReLU value is
  zero at the endpoint), with a tangent which is the difference between the
  target tanget and the tangent of the approximation until this point.

---
# Evolving ReLU Approximation
![w=75%,h=center](relu_approx-0.svg)

~~~ ~
# Evolving ReLU Approximation
![w=75%,h=center](relu_approx-1.svg)

~~~ ~
# Evolving ReLU Approximation
![w=75%,h=center](relu_approx-2.svg)

~~~ ~
# Evolving ReLU Approximation
![w=75%,h=center](relu_approx-3.svg)

~~~ ~
# Evolving ReLU Approximation
![w=75%,h=center](relu_approx-4.svg)

---
# Universal Approximation Theorem for Squashes

Sketch of the proof for a squashing function $œÜ(x)$ (i.e., nonconstant, bounded and
nondecreasing continuous function like sigmoid):

~~~
- We can prove $œÜ$ can be arbitrarily close to a hard threshold by compressing
  it horizontally.

![w=38%,h=center](universal_approximation_squash.png)

~~~
- Then we approximate the original function using a series of straight line
  segments

![w=38%,h=center](universal_approximation_rectangles.png)
